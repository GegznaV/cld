---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# cld: Compact Letter Display for Statistical Comparisons

<!-- badges: start -->
[![CRAN status](https://www.r-pkg.org/badges/version/cld)](https://CRAN.R-project.org/package=cld)
[![GitHub version](https://img.shields.io/badge/GitHub-`r packageVersion("cld")`-brightgreen.svg)](https://github.com/GegznaV/cld)
[![R-CMD-check](https://github.com/GegznaV/cld/actions/workflows/R-CMD-check.yaml/badge.svg)](https://github.com/GegznaV/cld/actions/workflows/R-CMD-check.yaml)
[![Codecov](https://codecov.io/gh/GegznaV/cld/branch/master/graph/badge.svg)](https://codecov.io/gh/GegznaV/cld)
[![Updated-on](https://img.shields.io/badge/Updated%20on-`r gsub('-', '--', Sys.Date())`-yellowgreen.svg)](/commits/master)
<!-- badges: end -->

> **Simplify your statistical reporting with compact letter displays**

The **cld** package provides an easy and consistent way to create compact letter displays (CLDs) for visualizing results of pairwise statistical comparisons. Groups sharing the same letter are not significantly different from each other ‚Äî a convention widely used in agricultural, biological, and statistical publications.

## Why Use cld?

‚úÖ **Universal compatibility** - Works with outputs from base R, PMCMRplus, rstatix, DescTools, and custom data frames  
‚úÖ **Consistent interface** - One function (`make_cld()`) handles all input types  
‚úÖ **Publication-ready** - Generate clean, professional statistical grouping labels  
‚úÖ **Well-tested** - 135+ tests ensuring reliability across all methods   
‚úÖ **Informative output** - Stores metadata (alpha, method, comparison counts) for transparency

## Installation

Install the stable version from CRAN:

```r
install.packages("cld")
```

Install the development version from [GitHub](https://github.com/GegznaV/cld):

```r
# install.packages("devtools")
devtools::install_github("GegznaV/cld")
```

## Quick Start

The **cld** package works with various statistical test outputs. Here's a simple example:

```{r quickstart, eval=FALSE}
library(cld)

# Run a pairwise test
test_result <- pairwise.wilcox.test(chickwts$weight, chickwts$feed, exact = FALSE)

# Generate compact letter display
make_cld(test_result)
#>      group cld spaced_cld
#>     casein   a        a__
#>  horsebean   b        _b_
#>    linseed  bc        _bc
#>   meatmeal  ac        a_c
#>    soybean   c        __c
#>  sunflower   a        a__
```

**Interpretation**: Groups with the same letter (e.g., casein and sunflower both have "a") are not significantly different. Groups without shared letters (e.g., horsebean "b" and soybean "c") are significantly different.


### Interpretation Rules

‚ùå At least one **shared letter** ‚Üí Groups are **NOT** significantly different  
‚úÖ **No shared letters** ‚Üí Groups **ARE** significantly different  

**Example:**

- ‚ùå Groups with "c" and "c" share letter "c" ‚Üí difference is not significant
- ‚ùå Groups with "a" and "ab" share letter "a" ‚Üí difference is not significant
- ‚ùå Groups "ab" and "bc"  share letter "b" ‚Üí difference is not significant
- ‚ùå Groups "abc" and "bcd"  share letters "b", and "c" ‚Üí difference is not significant
- ‚úÖ Groups with "a" and "c" share no letters ‚Üí significantly different
- ‚úÖ Groups with "abd" and "ce" share no letters ‚Üí significantly different


## Supported Input Formats

The `make_cld()` function works seamlessly with:

| Input Type | Example Packages | Function Examples |
|------------|-----------------|-------------------|
| `pairwise.htest` | base R | `pairwise.t.test()`, `pairwise.wilcox.test()` |
| `PMCMR` / `PMCMRplus` | PMCMR, PMCMRplus | `kwAllPairsConoverTest()`, `dunnTest()` |
| `posthoc_anova` | rstatix | `games_howell_test()`, `tukey_hsd()` |
| `PostHocTest` | DescTools | `ConoverTest()`, `DunnettTest()` |
| `matrix` | Custom | Symmetric p-value matrices |
| `data.frame` | Custom | Custom comparison data frames |
| `formula` | Custom | Formula interface for data frames |

## Examples

### Example 1: Base R Pairwise Tests

```{r example-basic}
library(cld)

# Pairwise Wilcoxon rank sum test
result <- pairwise.wilcox.test(chickwts$weight, chickwts$feed, exact = FALSE)
make_cld(result)

# Pairwise t-test
result2 <- pairwise.t.test(chickwts$weight, chickwts$feed)
make_cld(result2, alpha = 0.01)  # More stringent threshold
```

### Example 2: P-value Matrices

```{r example-matrix}
# Create a symmetric matrix of p-values
m <- matrix(c(
  1.00, 0.22, 0.05, 0.00,
  0.22, 1.00, 0.17, 0.01,
  0.05, 0.17, 1.00, 0.22,
  0.00, 0.01, 0.22, 1.00
), nrow = 4)
rownames(m) <- colnames(m) <- c("GroupA", "GroupB", "GroupC", "GroupD")

# Generate CLD
make_cld(m, alpha = 0.05)
```

### Example 3: PMCMRplus (Non-parametric Tests)

```{r example-pmcmr, eval=FALSE}
library(PMCMRplus)

# Kruskal-Wallis post-hoc test
kw_result <- kwAllPairsConoverTest(count ~ spray, data = InsectSprays)
make_cld(kw_result)
```

### Example 4: rstatix (Tidyverse-friendly)

```{r example-rstatix, eval=FALSE}
library(rstatix)

# Games-Howell test (for unequal variances)
gh_result <- games_howell_test(PlantGrowth, weight ~ group)
make_cld(gh_result)

# Tukey HSD test
tukey_result <- tukey_hsd(PlantGrowth, weight ~ group)
make_cld(tukey_result)
```

### Example 5: Data Frames (Custom Results)

```{r example-dataframe}
# Custom comparison results
comparisons <- data.frame(
  group1 = c("Treatment_A", "Treatment_A", "Treatment_B"),
  group2 = c("Treatment_B", "Treatment_C", "Treatment_C"),
  p.adj  = c(0.9, 0.02, 0.03)
)

make_cld(comparisons, alpha = 0.05)
```

### Example 6: Formula Interface

```{r example-formula}
# Using formula for data frames with custom column names
my_data <- data.frame(
  Comparison = c("A-B", "A-C", "B-C"),
  p_value = c(0.12, 0.001, 0.045),
  p_adjusted = c(0.18, 0.003, 0.068)
)

make_cld(p_adjusted ~ Comparison, data = my_data)
```

## Understanding the Output

### Structure

The `make_cld()` function returns a `cld_object` (enhanced data frame) with:

**Columns:**

- **group** - Names of the groups being compared
- **cld** - Compact letter display (letters only)
- **spaced_cld** - Monospaced version for alignment (underscores replace spaces)

**Attributes (metadata):**

- **alpha** - Significance level used
- **method** - Statistical test/method name
- **n_comparisons** - Total number of pairwise comparisons
- **n_significant** - Number of significant differences found

```{r output-demo}
result <- pairwise.wilcox.test(chickwts$weight, chickwts$feed, exact = FALSE)
cld_result <- make_cld(result)

# View result
cld_result

# Access metadata
attributes(cld_result)[c("alpha", "method", "n_comparisons", "n_significant")]
```


## Working with the Output

### Convert to Other Formats

```{r convert}
# Extract as named character vector
letters_only <- as.character(cld_result)
letters_only

# Convert back to plain data frame (removes metadata)
plain_df <- as.data.frame(cld_result)
class(plain_df)
```

### Adjust Significance Level

```{r example-alpha}
result <- pairwise.wilcox.test(chickwts$weight, chickwts$feed, exact = FALSE)

# Standard (alpha = 0.05)
make_cld(result, alpha = 0.05)

# More stringent (alpha = 0.01)
make_cld(result, alpha = 0.01)
```

## Common Use Cases

### üåæ Agricultural Studies
Comparing crop yields across different treatments or varieties
```r
# Example: Fertilizer treatments
fertilizer_test <- pairwise.t.test(yield, treatment, data = crop_data)
make_cld(fertilizer_test)
```

### üß™ Biological Research
Post-hoc comparisons after ANOVA in experimental biology
```r
# Example: Drug efficacy study
anova_result <- aov(response ~ drug_type, data = trial_data)
tukey_result <- TukeyHSD(anova_result)
# Convert and create CLD...
```

### üìä Quality Control
Comparing multiple production methods or batches
```r
# Example: Manufacturing process comparison
kruskal_result <- kruskal.test(strength ~ method, data = qc_data)
# Follow up with post-hoc test and CLD
```

### üìà Survey Analysis
Displaying pairwise differences between groups in survey data
```r
# Example: Satisfaction scores across departments
make_cld(comparison_results, alpha = 0.01)
```

## Advanced Features

### Custom Parameters

```{r advanced, eval=FALSE}
# Reverse letter ordering
make_cld(result, reversed = TRUE)

# Swap comparison name order
make_cld(result, swap_compared_names = TRUE)

# Print comparison names during processing
make_cld(result, print.comp = TRUE)

# Control string cleaning
make_cld(df, remove.space = TRUE, swap.colon = TRUE, remove.equal = TRUE)
```

### Integration with Plotting

```{r plotting, eval=FALSE}
library(ggplot2)

# Get CLD results
cld_result <- make_cld(test_result)

# Merge with summary statistics
plot_data <- merge(summary_stats, cld_result, by.x = "treatment", by.y = "group")

# Create plot with letter annotations
ggplot(plot_data, aes(x = treatment, y = mean)) +
  geom_col() +
  geom_text(aes(label = cld, y = mean + se), vjust = -0.5) +
  theme_minimal()
```

## Related Packages

| Package | Purpose | Relationship to cld |
|---------|---------|-------------------|
| [multcompView](https://cran.r-project.org/package=multcompView) | CLD algorithm | Used internally by **cld** |
| [rcompanion](https://cran.r-project.org/package=rcompanion) | Statistical functions | Alternative CLD implementation |
| [PMCMRplus](https://cran.r-project.org/package=PMCMRplus) | Post-hoc tests | Compatible input for **cld** |
| [rstatix](https://cran.r-project.org/package=rstatix) | Tidy statistics | Compatible input for **cld** |
| [DescTools](https://cran.r-project.org/package=DescTools) | Statistical tools | Compatible input for **cld** |
| [emmeans](https://cran.r-project.org/package=emmeans) | Marginal means | Planned future support |

## Getting Help

### Documentation
- üìñ Function reference: `?cld::make_cld`
- üìö Package website: [https://gegznav.github.io/cld/](https://gegznav.github.io/cld/)
- üí° Examples: See function documentation with `example(cld::make_cld)`

### Issues & Contributions
- üêõ Report bugs: <https://github.com/GegznaV/cld/issues>
- üí¨ Ask questions: Open a [GitHub Discussion](https://github.com/GegznaV/cld/discussions)
- üîß Contribute: Pull requests welcome!

## Citation

To cite the **cld** package in publications:

```{r citation, eval=FALSE}
citation("cld")
```

## License

GPL-3
